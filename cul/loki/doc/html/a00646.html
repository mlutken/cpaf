<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Loki: CachedFactory.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
    <li>
      <form action="search.php" method="get">
        <table cellspacing="0" cellpadding="0" border="0">
          <tr>
            <td><label>&nbsp;<u>S</u>earch&nbsp;for&nbsp;</label></td>
            <td><input type="text" name="query" value="" size="20" accesskey="s"/></td>
          </tr>
        </table>
      </form>
    </li>
  </ul></div>
<h1>CachedFactory.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="comment">// The Loki Library</span>
<a name="l00003"></a>00003 <span class="comment">// Copyright (c) 2006 by Guillaume Chatelet</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Code covered by the MIT License</span>
<a name="l00006"></a>00006 <span class="comment">//</span>
<a name="l00007"></a>00007 <span class="comment">// Permission to use, copy, modify, distribute and sell this software for any </span>
<a name="l00008"></a>00008 <span class="comment">// purpose is hereby granted without fee, provided that the above copyright </span>
<a name="l00009"></a>00009 <span class="comment">// notice appear in all copies and that both that copyright notice and this </span>
<a name="l00010"></a>00010 <span class="comment">// permission notice appear in supporting documentation.</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 <span class="comment">// The authors make no representations about the suitability of this software</span>
<a name="l00013"></a>00013 <span class="comment">// for any purpose. It is provided "as is" without express or implied warranty.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">// This code DOES NOT accompany the book:</span>
<a name="l00016"></a>00016 <span class="comment">// Alexandrescu, Andrei. "Modern C++ Design: Generic Programming and Design </span>
<a name="l00017"></a>00017 <span class="comment">//     Patterns Applied". Copyright (c) 2001. Addison-Wesley.</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00020"></a>00020 <span class="comment"></span><span class="preprocessor">#ifndef LOKI_CACHEDFACTORY_INC_</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#define LOKI_CACHEDFACTORY_INC_</span>
<a name="l00022"></a>00022 <span class="preprocessor"></span>
<a name="l00023"></a>00023 <span class="comment">// $Id: CachedFactory.h 810 2007-02-25 14:36:28Z syntheticpp $</span>
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;functional&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;loki/Key.h&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef DO_EXTRA_LOKI_TESTS</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">     #define D( x ) x</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">     #define D( x ) ;</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#include &lt;time.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#endif</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span>
<a name="l00056"></a>00056 <span class="keyword">namespace </span>Loki
<a name="l00057"></a>00057 {
<a name="l00071"></a>00071      <span class="keyword">template</span>&lt;<span class="keyword">class</span> AbstractProduct&gt;     
<a name="l00072"></a><a class="code" href="a00515.html">00072</a>      <span class="keyword">class </span><a class="code" href="a00515.html">SimplePointer</a>
<a name="l00073"></a>00073      {
<a name="l00074"></a>00074      <span class="keyword">protected</span>:
<a name="l00075"></a><a class="code" href="a00515.html#d72820118ec610b3eda0e5257c95ef0c">00075</a>            <span class="keyword">typedef</span> AbstractProduct* <a class="code" href="a00515.html#d72820118ec610b3eda0e5257c95ef0c">ProductReturn</a>;
<a name="l00076"></a><a class="code" href="a00515.html#ab6efd0c413b593ab3942ba34808d228">00076</a>            <a class="code" href="a00515.html#d72820118ec610b3eda0e5257c95ef0c">ProductReturn</a> <a class="code" href="a00515.html#ab6efd0c413b593ab3942ba34808d228">encapsulate</a>(AbstractProduct* pProduct)
<a name="l00077"></a>00077            {
<a name="l00078"></a>00078                 <span class="keywordflow">return</span> pProduct;
<a name="l00079"></a>00079            }
<a name="l00080"></a>00080            
<a name="l00081"></a><a class="code" href="a00515.html#772e4bb9e48173c58b79442f7c64d62c">00081</a>            AbstractProduct* <a class="code" href="a00515.html#772e4bb9e48173c58b79442f7c64d62c">release</a>(<a class="code" href="a00515.html#d72820118ec610b3eda0e5257c95ef0c">ProductReturn</a> &amp;pProduct)
<a name="l00082"></a>00082            {
<a name="l00083"></a>00083                 AbstractProduct* pPointer(pProduct);
<a name="l00084"></a>00084                 pProduct=NULL;
<a name="l00085"></a>00085                 <span class="keywordflow">return</span> pPointer;
<a name="l00086"></a>00086            }
<a name="l00087"></a><a class="code" href="a00515.html#62b77e2b442d2d367fda4cb027bcf29d">00087</a>            <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00515.html#62b77e2b442d2d367fda4cb027bcf29d">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"pointer"</span>;}
<a name="l00088"></a>00088      };
<a name="l00089"></a>00089 
<a name="l00108"></a><a class="code" href="a00449.html">00108</a>      <span class="keyword">class </span><a class="code" href="a00449.html">NeverCreate</a>
<a name="l00109"></a>00109      {
<a name="l00110"></a>00110      <span class="keyword">protected</span>:
<a name="l00111"></a><a class="code" href="a00450.html">00111</a>             <span class="keyword">struct </span><a class="code" href="a00450.html">Exception</a> : <span class="keyword">public</span> std::exception
<a name="l00112"></a>00112             {
<a name="l00113"></a><a class="code" href="a00450.html#4e46d22145830cc7045cadd51791089f">00113</a>                 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00450.html#4e46d22145830cc7045cadd51791089f">what</a>() const throw() { <span class="keywordflow">return</span> <span class="stringliteral">"NeverFetch Policy : No Fetching allowed"</span>; }
<a name="l00114"></a>00114             };
<a name="l00115"></a>00115             
<a name="l00116"></a><a class="code" href="a00449.html#721c77b8798980d7f2728562033386db">00116</a>             <span class="keywordtype">bool</span> <a class="code" href="a00449.html#721c77b8798980d7f2728562033386db">canCreate</a>()
<a name="l00117"></a>00117             {
<a name="l00118"></a>00118                 <span class="keywordflow">throw</span> <a class="code" href="a00450.html">Exception</a>();
<a name="l00119"></a>00119             }
<a name="l00120"></a>00120             
<a name="l00121"></a><a class="code" href="a00449.html#c360e05951ecfea73f557e76a32808b0">00121</a>             <span class="keywordtype">void</span> <a class="code" href="a00449.html#c360e05951ecfea73f557e76a32808b0">onCreate</a>(){}
<a name="l00122"></a><a class="code" href="a00449.html#7c01df3587354eead5a78b23ac534fb3">00122</a>             <span class="keywordtype">void</span> <a class="code" href="a00449.html#7c01df3587354eead5a78b23ac534fb3">onDestroy</a>(){}
<a name="l00123"></a><a class="code" href="a00449.html#32fb9b99996115be09fe61a5b8f5eebc">00123</a>             <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00449.html#32fb9b99996115be09fe61a5b8f5eebc">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"never"</span>;}
<a name="l00124"></a>00124      };
<a name="l00125"></a>00125      
<a name="l00133"></a><a class="code" href="a00016.html">00133</a>      <span class="keyword">class </span><a class="code" href="a00016.html">AlwaysCreate</a>
<a name="l00134"></a>00134      {
<a name="l00135"></a>00135      <span class="keyword">protected</span>:
<a name="l00136"></a><a class="code" href="a00016.html#ac5cf849ab2569d52c4db1dcef257e90">00136</a>             <span class="keywordtype">bool</span> <a class="code" href="a00016.html#ac5cf849ab2569d52c4db1dcef257e90">canCreate</a>()
<a name="l00137"></a>00137             {
<a name="l00138"></a>00138                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00139"></a>00139             }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="a00016.html#9d46a0472c0d9d740c23784aebe8752d">00141</a>             <span class="keywordtype">void</span> <a class="code" href="a00016.html#9d46a0472c0d9d740c23784aebe8752d">onCreate</a>(){}
<a name="l00142"></a><a class="code" href="a00016.html#8273b409f4bb17992b96d37c4a613875">00142</a>             <span class="keywordtype">void</span> <a class="code" href="a00016.html#8273b409f4bb17992b96d37c4a613875">onDestroy</a>(){}
<a name="l00143"></a><a class="code" href="a00016.html#4f32a383b5651a0274bf4c6bcc70ebf2">00143</a>             <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00016.html#4f32a383b5651a0274bf4c6bcc70ebf2">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"always"</span>;}
<a name="l00144"></a>00144      };
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 
<a name="l00158"></a>00158      <span class="comment">// !! CAUTION !!</span>
<a name="l00159"></a>00159      <span class="comment">// The std::clock() function is not quite precise</span>
<a name="l00160"></a>00160      <span class="comment">// under linux this policy might not work.</span>
<a name="l00161"></a>00161      <span class="comment">// TODO : get a better implementation (platform dependant)</span>
<a name="l00162"></a><a class="code" href="a00479.html">00162</a>      <span class="keyword">class </span><a class="code" href="a00479.html">RateLimitedCreation</a>
<a name="l00163"></a>00163      {
<a name="l00164"></a>00164      <span class="keyword">private</span>:
<a name="l00165"></a>00165             <span class="keyword">typedef</span> std::vector&lt; clock_t &gt; Vector;
<a name="l00166"></a>00166             Vector m_vTimes;
<a name="l00167"></a>00167             <span class="keywordtype">unsigned</span> maxCreation;
<a name="l00168"></a>00168             clock_t timeValidity;
<a name="l00169"></a>00169             clock_t lastUpdate;
<a name="l00170"></a>00170           
<a name="l00171"></a>00171             <span class="keywordtype">void</span> cleanVector()
<a name="l00172"></a>00172             {
<a name="l00173"></a>00173                <span class="keyword">using namespace </span>std;
<a name="l00174"></a>00174                     clock_t currentTime = clock();
<a name="l00175"></a>00175                 D( cout &lt;&lt; <span class="stringliteral">"currentTime = "</span> &lt;&lt; currentTime&lt;&lt; endl; )
<a name="l00176"></a>00176                 D( cout &lt;&lt; <span class="stringliteral">"currentTime - lastUpdate = "</span> &lt;&lt; currentTime - lastUpdate&lt;&lt; endl; )
<a name="l00177"></a>00177                 <span class="keywordflow">if</span>(currentTime - lastUpdate &gt; timeValidity)
<a name="l00178"></a>00178                 {
<a name="l00179"></a>00179                     m_vTimes.clear();
<a name="l00180"></a>00180                     D( cout &lt;&lt; <span class="stringliteral">" is less than time validity "</span> &lt;&lt; timeValidity; )
<a name="l00181"></a>00181                     D( cout &lt;&lt; <span class="stringliteral">" so clearing vector"</span> &lt;&lt; endl; )
<a name="l00182"></a>00182                 }
<a name="l00183"></a>00183                 <span class="keywordflow">else</span>
<a name="l00184"></a>00184                 {
<a name="l00185"></a>00185                     D( cout &lt;&lt; <span class="stringliteral">"Cleaning time less than "</span> &lt;&lt; currentTime - timeValidity &lt;&lt; endl; )
<a name="l00186"></a>00186                     D( displayVector(); )
<a name="l00187"></a>00187                     Vector::iterator newEnd = remove_if(m_vTimes.begin(), m_vTimes.end(), bind2nd(less&lt;clock_t&gt;(), currentTime - timeValidity));
<a name="l00188"></a>00188                     <span class="comment">// this rearrangement might be costly, consider optimization</span>
<a name="l00189"></a>00189                     <span class="comment">// by calling cleanVector in less used onCreate function</span>
<a name="l00190"></a>00190                     <span class="comment">// ... although it may not be correct</span>
<a name="l00191"></a>00191                     m_vTimes.erase(newEnd, m_vTimes.end());
<a name="l00192"></a>00192                     D( displayVector(); )
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194                 lastUpdate = currentTime;
<a name="l00195"></a>00195             }
<a name="l00196"></a>00196 <span class="preprocessor">#ifdef DO_EXTRA_LOKI_TESTS        </span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>            <span class="keywordtype">void</span> displayVector()
<a name="l00198"></a>00198             {
<a name="l00199"></a>00199                 std::cout &lt;&lt; <span class="stringliteral">"Vector : "</span>;
<a name="l00200"></a>00200                 copy(m_vTimes.begin(), m_vTimes.end(), std::ostream_iterator&lt;clock_t&gt;(std::cout, <span class="stringliteral">" "</span>));
<a name="l00201"></a>00201                 std::cout &lt;&lt; std::endl;
<a name="l00202"></a>00202             }
<a name="l00203"></a>00203 <span class="preprocessor">#endif</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>     <span class="keyword">protected</span>:
<a name="l00205"></a><a class="code" href="a00479.html#c05a2ec8e9a8f1f1816c162f95664328">00205</a>             <a class="code" href="a00479.html#c05a2ec8e9a8f1f1816c162f95664328">RateLimitedCreation</a>() : maxCreation(10), timeValidity(CLOCKS_PER_SEC), lastUpdate(clock())
<a name="l00206"></a>00206             {}
<a name="l00207"></a>00207             
<a name="l00208"></a><a class="code" href="a00480.html">00208</a>             <span class="keyword">struct </span><a class="code" href="a00480.html">Exception</a> : <span class="keyword">public</span> std::exception
<a name="l00209"></a>00209             {
<a name="l00210"></a><a class="code" href="a00480.html#47c5c9b0f1b33b2e6bf5c5b947742b87">00210</a>                 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00480.html#47c5c9b0f1b33b2e6bf5c5b947742b87">what</a>() const throw() { <span class="keywordflow">return</span> <span class="stringliteral">"RateLimitedCreation Policy : Exceeded the authorized creation rate"</span>; }
<a name="l00211"></a>00211             };
<a name="l00212"></a>00212             
<a name="l00213"></a><a class="code" href="a00479.html#36485819e1d274e5a70c8a9430503263">00213</a>             <span class="keywordtype">bool</span> <a class="code" href="a00479.html#36485819e1d274e5a70c8a9430503263">canCreate</a>()
<a name="l00214"></a>00214             {
<a name="l00215"></a>00215                 cleanVector();
<a name="l00216"></a>00216                 <span class="keywordflow">if</span>(m_vTimes.size()&gt;maxCreation)
<a name="l00217"></a>00217                     <span class="keywordflow">throw</span> <a class="code" href="a00480.html">Exception</a>();
<a name="l00218"></a>00218                 <span class="keywordflow">else</span>
<a name="l00219"></a>00219                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00220"></a>00220             }
<a name="l00221"></a>00221 
<a name="l00222"></a><a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">00222</a>             <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>()
<a name="l00223"></a>00223             {
<a name="l00224"></a>00224                     m_vTimes.push_back(clock());
<a name="l00225"></a>00225             }
<a name="l00226"></a>00226             
<a name="l00227"></a><a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">00227</a>             <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>()
<a name="l00228"></a>00228             {
<a name="l00229"></a>00229             }
<a name="l00230"></a><a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">00230</a>             <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"rate limited"</span>;}
<a name="l00231"></a>00231      <span class="keyword">public</span>:
<a name="l00232"></a>00232             <span class="comment">// set the creation rate</span>
<a name="l00233"></a>00233             <span class="comment">// No more than maxCreation within byTime milliseconds</span>
<a name="l00234"></a><a class="code" href="a00479.html#8e12d2e7e301faf81ada4e7d6b509635">00234</a>             <span class="keywordtype">void</span> <a class="code" href="a00479.html#8e12d2e7e301faf81ada4e7d6b509635">setRate</a>(<span class="keywordtype">unsigned</span> maxCreation, <span class="keywordtype">unsigned</span> byTime)
<a name="l00235"></a>00235             {
<a name="l00236"></a>00236                 assert(byTime&gt;0);
<a name="l00237"></a>00237                 this-&gt;maxCreation = maxCreation;
<a name="l00238"></a>00238                 this-&gt;timeValidity = static_cast&lt;clock_t&gt;(byTime * CLOCKS_PER_SEC / 1000);
<a name="l00239"></a>00239                 D( std::cout &lt;&lt; <span class="stringliteral">"Setting no more than "</span>&lt;&lt; maxCreation &lt;&lt;<span class="stringliteral">" creation within "</span> &lt;&lt; this-&gt;timeValidity &lt;&lt;<span class="stringliteral">" ms"</span>&lt;&lt; std::endl; )
<a name="l00240"></a>00240             }
<a name="l00241"></a>00241      };
<a name="l00242"></a>00242      
<a name="l00253"></a><a class="code" href="a00017.html">00253</a>      <span class="keyword">class </span><a class="code" href="a00017.html">AmountLimitedCreation</a>
<a name="l00254"></a>00254      {
<a name="l00255"></a>00255      <span class="keyword">private</span>:
<a name="l00256"></a>00256             <span class="keywordtype">unsigned</span> maxCreation;
<a name="l00257"></a>00257             <span class="keywordtype">unsigned</span> created;
<a name="l00258"></a>00258             
<a name="l00259"></a>00259      <span class="keyword">protected</span>:
<a name="l00260"></a><a class="code" href="a00017.html#fc9c6a5efbcdbd8de2fd2cf3d701b68c">00260</a>             <a class="code" href="a00017.html">AmountLimitedCreation</a>() : maxCreation(10), created(0)
<a name="l00261"></a>00261             {}
<a name="l00262"></a>00262             
<a name="l00263"></a><a class="code" href="a00017.html#34f40f022197c7e9ec74898105b379e9">00263</a>             <span class="keywordtype">bool</span> <a class="code" href="a00479.html#36485819e1d274e5a70c8a9430503263">canCreate</a>()
<a name="l00264"></a>00264             {
<a name="l00265"></a>00265                <span class="keywordflow">return</span> !(created&gt;=maxCreation);
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="a00017.html#ea057bad31c6cdc6176829496b8d5bf3">00268</a>             <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>()
<a name="l00269"></a>00269             {
<a name="l00270"></a>00270                 ++created;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272             
<a name="l00273"></a><a class="code" href="a00017.html#99170f38e9837d5a9f5382b37bfb6945">00273</a>             <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>()
<a name="l00274"></a>00274             {
<a name="l00275"></a>00275                 --created;
<a name="l00276"></a>00276             }
<a name="l00277"></a><a class="code" href="a00017.html#07b90847a2511fb1374428ce5013bea5">00277</a>             <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"amount limited"</span>;}
<a name="l00278"></a>00278      <span class="keyword">public</span>:
<a name="l00279"></a>00279             <span class="comment">// set the creation max amount</span>
<a name="l00280"></a><a class="code" href="a00017.html#9a58222f8a3c72c68c6d0df6343c9bc2">00280</a>             <span class="keywordtype">void</span> setMaxCreation(<span class="keywordtype">unsigned</span> maxCreation)
<a name="l00281"></a>00281             {
<a name="l00282"></a>00282                 assert(maxCreation&gt;0);
<a name="l00283"></a>00283                 this-&gt;maxCreation = maxCreation;
<a name="l00284"></a>00284                 D( std::cout &lt;&lt; <span class="stringliteral">"Setting no more than "</span> &lt;&lt; maxCreation &lt;&lt;<span class="stringliteral">" creation"</span> &lt;&lt; std::endl; )
<a name="l00285"></a>00285             }
<a name="l00286"></a>00286      };
<a name="l00287"></a>00287      
<a name="l00295"></a><a class="code" href="a00094.html">00295</a>     <span class="keyword">class </span><a class="code" href="a00094.html">EvictionException</a> : <span class="keyword">public</span> std::exception
<a name="l00296"></a>00296     {
<a name="l00297"></a>00297     <span class="keyword">public</span>:
<a name="l00298"></a><a class="code" href="a00094.html#79e4736abb4a9323b9219638501256f1">00298</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* what() const throw() { <span class="keywordflow">return</span> <span class="stringliteral">"Eviction Policy : trying to make room but no objects are available"</span>; }
<a name="l00299"></a>00299     };
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     <span class="comment">// The following class is intented to provide helpers to sort</span>
<a name="l00302"></a>00302     <span class="comment">// the container that will hold an eviction score</span>
<a name="l00303"></a>00303     <span class="keyword">template</span>
<a name="l00304"></a>00304     &lt;
<a name="l00305"></a>00305      <span class="keyword">typename</span> ST, <span class="comment">// Score type</span>
<a name="l00306"></a>00306      <span class="keyword">typename</span> DT <span class="comment">// Data type</span>
<a name="l00307"></a>00307     &gt;
<a name="l00308"></a><a class="code" href="a00095.html">00308</a>     <span class="keyword">class </span><a class="code" href="a00095.html">EvictionHelper</a>
<a name="l00309"></a>00309     {
<a name="l00310"></a>00310     <span class="keyword">protected</span>:
<a name="l00311"></a><a class="code" href="a00095.html#be1d96686b9e0bd2622b43131a915b23">00311</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> std::map&lt; DT, ST &gt;            HitMap;
<a name="l00312"></a><a class="code" href="a00095.html#72ffc3d39b0700bd812102de11ae8c63">00312</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> HitMap::iterator              HitMapItr;
<a name="l00313"></a>00313     <span class="keyword">private</span>:
<a name="l00314"></a>00314         <span class="keyword">typedef</span> std::pair&lt; ST, DT &gt;                         SwappedPair;
<a name="l00315"></a>00315         <span class="keyword">typedef</span> std::multimap&lt; ST, DT &gt;                SwappedHitMap;
<a name="l00316"></a>00316      <span class="keyword">typedef</span>   <span class="keyword">typename</span> SwappedHitMap::iterator   SwappedHitMapItr;
<a name="l00317"></a>00317     <span class="keyword">protected</span>:
<a name="l00318"></a><a class="code" href="a00095.html#e9d643e6c2b125392236f5496ee0a198">00318</a>         HitMap                                              m_mHitCount;
<a name="l00319"></a>00319      
<a name="l00320"></a>00320      <span class="comment">// This function sorts the map according to the score</span>
<a name="l00321"></a>00321      <span class="comment">// and returns the lower bound of the sorted container</span>
<a name="l00322"></a><a class="code" href="a00095.html#dfe95d3f4c721e4e4beb427c10de4997">00322</a>      DT&amp;  getLowerBound(){
<a name="l00323"></a>00323           assert(!m_mHitCount.empty());
<a name="l00324"></a>00324           <span class="comment">// inserting the swapped pair into a multimap</span>
<a name="l00325"></a>00325           SwappedHitMap copyMap;
<a name="l00326"></a>00326           <span class="keywordflow">for</span>(HitMapItr itr = m_mHitCount.begin(); itr != m_mHitCount.end(); ++itr)
<a name="l00327"></a>00327                copyMap.insert(SwappedPair((*itr).second, (*itr).first));
<a name="l00328"></a>00328           <span class="keywordflow">if</span>((*copyMap.rbegin()).first == 0) <span class="comment">// the higher score is 0 ...</span>
<a name="l00329"></a>00329             <span class="keywordflow">throw</span> <a class="code" href="a00094.html">EvictionException</a>(); <span class="comment">// there is no key evict</span>
<a name="l00330"></a>00330           <span class="keywordflow">return</span> (*copyMap.begin()).second;
<a name="l00331"></a>00331      }
<a name="l00332"></a>00332     };
<a name="l00333"></a>00333     
<a name="l00346"></a>00346     <span class="keyword">template</span>
<a name="l00347"></a>00347     &lt;
<a name="l00348"></a>00348      <span class="keyword">typename</span> DT, <span class="comment">// Data Type (AbstractProduct*)</span>
<a name="l00349"></a>00349      <span class="keyword">typename</span> ST = <span class="keywordtype">unsigned</span> <span class="comment">// default data type to use as Score Type</span>
<a name="l00350"></a>00350     &gt;
<a name="l00351"></a><a class="code" href="a00096.html">00351</a>     <span class="keyword">class </span><a class="code" href="a00096.html">EvictLRU</a> : <span class="keyword">public</span> <a class="code" href="a00095.html">EvictionHelper</a>&lt; ST , DT &gt;
<a name="l00352"></a>00352     {
<a name="l00353"></a>00353     <span class="keyword">private</span>:
<a name="l00354"></a>00354      <span class="keyword">typedef</span> <a class="code" href="a00095.html">EvictionHelper&lt; ST , DT &gt;</a>  <a class="code" href="a00095.html">EH</a>;
<a name="l00355"></a>00355     <span class="keyword">protected</span>:
<a name="l00356"></a>00356         
<a name="l00357"></a><a class="code" href="a00096.html#ae9568c7f5f371f1cafe732e59f11887">00357</a>         <span class="keyword">virtual</span> ~<a class="code" href="a00096.html">EvictLRU</a>(){}
<a name="l00358"></a>00358         
<a name="l00359"></a>00359      <span class="comment">// OnStore initialize the counter for the new key</span>
<a name="l00360"></a>00360      <span class="comment">// If the key already exists, the counter is reseted</span>
<a name="l00361"></a><a class="code" href="a00096.html#5982a28a470f49676881bb05ec2f2760">00361</a>      <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(<span class="keyword">const</span> DT&amp; key)
<a name="l00362"></a>00362         {
<a name="l00363"></a>00363           EH::m_mHitCount[key] = 0;
<a name="l00364"></a>00364      }
<a name="l00365"></a>00365      
<a name="l00366"></a><a class="code" href="a00096.html#bc7f4d133d366dfa1f141c990e29cd16">00366</a>      <span class="keywordtype">void</span> onFetch(<span class="keyword">const</span> DT&amp;)
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368      }
<a name="l00369"></a>00369      
<a name="l00370"></a>00370      <span class="comment">// onRelease increments the hit counter associated with the object</span>
<a name="l00371"></a><a class="code" href="a00096.html#8a2a0c1becb607a5c3147e7e17571180">00371</a>         <span class="keywordtype">void</span> onRelease(<span class="keyword">const</span> DT&amp; key)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373           ++(EH::m_mHitCount[key]);
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375 
<a name="l00376"></a><a class="code" href="a00096.html#25b762e1f387bc962c92eba6d771a71a">00376</a>      <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(<span class="keyword">const</span> DT&amp; key)
<a name="l00377"></a>00377      {
<a name="l00378"></a>00378             EH::m_mHitCount.erase(key);
<a name="l00379"></a>00379      }
<a name="l00380"></a>00380      
<a name="l00381"></a>00381      <span class="comment">// this function is implemented in Cache and redirected</span>
<a name="l00382"></a>00382      <span class="comment">// to the Storage Policy</span>
<a name="l00383"></a>00383      <span class="keyword">virtual</span> <span class="keywordtype">void</span> remove(DT <span class="keyword">const</span> key)=0;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385      <span class="comment">// LRU Eviction policy</span>
<a name="l00386"></a><a class="code" href="a00096.html#096fa684040eec490b15adc51a262a05">00386</a>      <span class="keywordtype">void</span> evict()
<a name="l00387"></a>00387      {
<a name="l00388"></a>00388           remove(EH::getLowerBound());
<a name="l00389"></a>00389      }
<a name="l00390"></a><a class="code" href="a00096.html#8f3587ef1de88468975d87a88a94faf2">00390</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"LRU"</span>;}
<a name="l00391"></a>00391     };
<a name="l00392"></a>00392     
<a name="l00404"></a>00404     <span class="keyword">template</span>
<a name="l00405"></a>00405     &lt;
<a name="l00406"></a>00406      <span class="keyword">typename</span> DT, <span class="comment">// Data Type (AbstractProduct*)</span>
<a name="l00407"></a>00407      <span class="keyword">typename</span> ST = <span class="keywordtype">unsigned</span> <span class="comment">// default data type to use as Score Type</span>
<a name="l00408"></a>00408     &gt;
<a name="l00409"></a><a class="code" href="a00093.html">00409</a>     <span class="keyword">class </span><a class="code" href="a00093.html">EvictAging</a> : <span class="keyword">public</span> <a class="code" href="a00095.html">EvictionHelper</a>&lt; ST, DT &gt;
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411     <span class="keyword">private</span>:
<a name="l00412"></a>00412         <a class="code" href="a00093.html">EvictAging</a>(<span class="keyword">const</span> <a class="code" href="a00093.html">EvictAging</a>&amp;);
<a name="l00413"></a>00413         <a class="code" href="a00093.html">EvictAging</a>&amp; operator=(<span class="keyword">const</span> <a class="code" href="a00093.html">EvictAging</a>&amp;);
<a name="l00414"></a>00414      <span class="keyword">typedef</span> <a class="code" href="a00095.html">EvictionHelper&lt; ST, DT &gt;</a>                       <a class="code" href="a00095.html">EH</a>;
<a name="l00415"></a>00415      <span class="keyword">typedef</span> <span class="keyword">typename</span> EH::HitMap                            HitMap;
<a name="l00416"></a>00416      <span class="keyword">typedef</span> <span class="keyword">typename</span> EH::HitMapItr                         HitMapItr;
<a name="l00417"></a>00417      
<a name="l00418"></a>00418      <span class="comment">// update the counter</span>
<a name="l00419"></a>00419           <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span>updateCounter : <span class="keyword">public</span> std::unary_function&lt;T, void&gt;
<a name="l00420"></a>00420           {
<a name="l00421"></a>00421                updateCounter(<span class="keyword">const</span> DT&amp; key): key_(key){}
<a name="l00422"></a>00422                <span class="keywordtype">void</span> operator()(T x)
<a name="l00423"></a>00423                {
<a name="l00424"></a>00424                     x.second = (x.first == key_ ? (x.second &gt;&gt; 1) | ( 1 &lt;&lt; ((<span class="keyword">sizeof</span>(ST)-1)*8) ) : x.second &gt;&gt; 1);
<a name="l00425"></a>00425                D( std::cout &lt;&lt;  x.second &lt;&lt; std::endl; )
<a name="l00426"></a>00426                }
<a name="l00427"></a>00427                <span class="keyword">const</span> DT &amp;key_;
<a name="l00428"></a>00428             updateCounter(<span class="keyword">const</span> updateCounter&amp; rhs) : key_(rhs.key_){}
<a name="l00429"></a>00429         <span class="keyword">private</span>:
<a name="l00430"></a>00430             updateCounter&amp; operator=(<span class="keyword">const</span> updateCounter&amp; rhs);
<a name="l00431"></a>00431           };
<a name="l00432"></a>00432     <span class="keyword">protected</span>:
<a name="l00433"></a><a class="code" href="a00093.html#728198ec7e3c1f542ab2d39f72aca82a">00433</a>          <a class="code" href="a00093.html">EvictAging</a>(){}
<a name="l00434"></a><a class="code" href="a00093.html#4fc82c59f8a58d48e15f2c17ca02f5f4">00434</a>          <span class="keyword">virtual</span> ~<a class="code" href="a00093.html">EvictAging</a>(){}
<a name="l00435"></a>00435          
<a name="l00436"></a>00436      <span class="comment">// OnStore initialize the counter for the new key</span>
<a name="l00437"></a>00437      <span class="comment">// If the key already exists, the counter is reseted</span>
<a name="l00438"></a><a class="code" href="a00093.html#c4a0cdf80f22d98ad696da91dcb1e4d5">00438</a>      <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(<span class="keyword">const</span> DT&amp; key){
<a name="l00439"></a>00439           EH::m_mHitCount[key] = 0;
<a name="l00440"></a>00440      }
<a name="l00441"></a>00441      
<a name="l00442"></a><a class="code" href="a00093.html#382ba43c28b7864b9678e9457c778cee">00442</a>      <span class="keywordtype">void</span> onFetch(<span class="keyword">const</span> DT&amp;){}
<a name="l00443"></a>00443      
<a name="l00444"></a>00444      <span class="comment">// onRelease increments the hit counter associated with the object</span>
<a name="l00445"></a>00445      <span class="comment">// Updating every counters by iterating over the map</span>
<a name="l00446"></a>00446      <span class="comment">// If the key is the key of the fetched object :</span>
<a name="l00447"></a>00447      <span class="comment">//  the counter is shifted to the right and it's MSB is set to 1</span>
<a name="l00448"></a>00448      <span class="comment">// else</span>
<a name="l00449"></a>00449      <span class="comment">//  the counter is shifted to the left</span>
<a name="l00450"></a><a class="code" href="a00093.html#8b71ad6ad6295fe27316cc2f65faa3d0">00450</a>         <span class="keywordtype">void</span> onRelease(<span class="keyword">const</span> DT&amp; key)
<a name="l00451"></a>00451         {
<a name="l00452"></a>00452           std::for_each(EH::m_mHitCount.begin(), EH::m_mHitCount.end(), updateCounter&lt; typename HitMap::value_type &gt;(key));
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454         
<a name="l00455"></a><a class="code" href="a00093.html#5539815b5f6e90c39875775b38b373c6">00455</a>         <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(<span class="keyword">const</span> DT&amp; key)
<a name="l00456"></a>00456         {
<a name="l00457"></a>00457             EH::m_mHitCount.erase(key);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459 
<a name="l00460"></a>00460      <span class="comment">// this function is implemented in Cache and redirected</span>
<a name="l00461"></a>00461      <span class="comment">// to the Storage Policy</span>
<a name="l00462"></a>00462      <span class="keyword">virtual</span> <span class="keywordtype">void</span> remove(DT <span class="keyword">const</span> key)=0;
<a name="l00463"></a>00463 
<a name="l00464"></a>00464      <span class="comment">// LRU with Aging Eviction policy</span>
<a name="l00465"></a><a class="code" href="a00093.html#65bf1f39e6d12ed9ed7f0ee24ef7c155">00465</a>      <span class="keywordtype">void</span> evict()
<a name="l00466"></a>00466      {
<a name="l00467"></a>00467           remove(EH::getLowerBound());
<a name="l00468"></a>00468      }
<a name="l00469"></a><a class="code" href="a00093.html#3da86be442d6a3455bbe6e2e1ac3be15">00469</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"LRU with aging"</span>;}
<a name="l00470"></a>00470     };
<a name="l00471"></a>00471     
<a name="l00480"></a>00480     <span class="keyword">template</span>
<a name="l00481"></a>00481     &lt;
<a name="l00482"></a>00482      <span class="keyword">typename</span> DT, <span class="comment">// Data Type (AbstractProduct*)</span>
<a name="l00483"></a>00483      <span class="keyword">typename</span> ST = <span class="keywordtype">void</span> <span class="comment">// Score Type not used by this policy</span>
<a name="l00484"></a>00484     &gt;
<a name="l00485"></a><a class="code" href="a00097.html">00485</a>     <span class="keyword">class </span><a class="code" href="a00097.html">EvictRandom</a>
<a name="l00486"></a>00486     {
<a name="l00487"></a>00487     <span class="keyword">private</span>:
<a name="l00488"></a>00488      std::vector&lt; DT &gt;   m_vKeys;
<a name="l00489"></a>00489      <span class="keyword">typedef</span> <span class="keyword">typename</span> std::vector&lt; DT &gt;::size_type     size_type;
<a name="l00490"></a>00490      <span class="keyword">typedef</span> <span class="keyword">typename</span> std::vector&lt; DT &gt;::iterator      iterator;
<a name="l00491"></a>00491 
<a name="l00492"></a>00492     <span class="keyword">protected</span>:
<a name="l00493"></a>00493     
<a name="l00494"></a><a class="code" href="a00097.html#007f7db460019419645ceaf6df9894ce">00494</a>           <span class="keyword">virtual</span> ~<a class="code" href="a00097.html">EvictRandom</a>(){};
<a name="l00495"></a>00495           
<a name="l00496"></a><a class="code" href="a00097.html#c0fb50f3b85ba583fa568eb9e3514c1c">00496</a>      <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(<span class="keyword">const</span> DT&amp;){
<a name="l00497"></a>00497      }
<a name="l00498"></a>00498      
<a name="l00499"></a><a class="code" href="a00097.html#6941d04a9d28ca0853794144fa368ac7">00499</a>      <span class="keywordtype">void</span> onFetch(<span class="keyword">const</span> DT&amp; ){
<a name="l00500"></a>00500      }
<a name="l00501"></a>00501 
<a name="l00502"></a><a class="code" href="a00097.html#847733034188570ddbc85bb9ef569a92">00502</a>      <span class="keywordtype">void</span> onRelease(<span class="keyword">const</span> DT&amp; key){
<a name="l00503"></a>00503             m_vKeys.push_back(key);
<a name="l00504"></a>00504      }
<a name="l00505"></a>00505      
<a name="l00506"></a><a class="code" href="a00097.html#fbb21cd053c738d5fb9de7ae585c36db">00506</a>      <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(<span class="keyword">const</span> DT&amp; key){
<a name="l00507"></a>00507           <span class="keyword">using namespace </span>std;
<a name="l00508"></a>00508             m_vKeys.erase(remove_if(m_vKeys.begin(), m_vKeys.end(), bind2nd(equal_to&lt; DT &gt;(), key)), m_vKeys.end());
<a name="l00509"></a>00509      }
<a name="l00510"></a>00510      
<a name="l00511"></a>00511      <span class="comment">// Implemented in Cache and redirected to the Storage Policy</span>
<a name="l00512"></a>00512      <span class="keyword">virtual</span> <span class="keywordtype">void</span> remove(DT <span class="keyword">const</span> key)=0;
<a name="l00513"></a>00513 
<a name="l00514"></a>00514      <span class="comment">// Random Eviction policy</span>
<a name="l00515"></a><a class="code" href="a00097.html#50482188122aaa94bcf0a75635354821">00515</a>      <span class="keywordtype">void</span> evict()
<a name="l00516"></a>00516      {
<a name="l00517"></a>00517           <span class="keywordflow">if</span>(m_vKeys.empty())
<a name="l00518"></a>00518               <span class="keywordflow">throw</span> <a class="code" href="a00094.html">EvictionException</a>();
<a name="l00519"></a>00519           size_type random = static_cast&lt;size_type&gt;((m_vKeys.size()*rand())/<span class="keywordtype">int</span>(RAND_MAX + 1));
<a name="l00520"></a>00520           remove(*(m_vKeys.begin()+random));
<a name="l00521"></a>00521      }
<a name="l00522"></a><a class="code" href="a00097.html#6f2bcfe45c79e23b529ec6c7c3b0802b">00522</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"random"</span>;}
<a name="l00523"></a>00523     };
<a name="l00524"></a>00524 
<a name="l00541"></a><a class="code" href="a00457.html">00541</a>     <span class="keyword">class </span><a class="code" href="a00457.html">NoStatisticPolicy</a>
<a name="l00542"></a>00542     {
<a name="l00543"></a>00543     <span class="keyword">protected</span>:
<a name="l00544"></a><a class="code" href="a00457.html#8cf6adc671ca4c8eef86d94cd0c04251">00544</a>         <span class="keywordtype">void</span> onDebug(){}
<a name="l00545"></a><a class="code" href="a00457.html#16a71f855cc9b13f5e75ebcef3b1e505">00545</a>         <span class="keywordtype">void</span> onFetch(){}
<a name="l00546"></a><a class="code" href="a00457.html#7042ec0645787a37fad14c5212f351d4">00546</a>         <span class="keywordtype">void</span> onRelease(){}
<a name="l00547"></a><a class="code" href="a00457.html#e7f1419da67cb866e9524547a630772b">00547</a>         <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(){}
<a name="l00548"></a><a class="code" href="a00457.html#8db2c4ee9d9e0c33b7261de6dad13dec">00548</a>         <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(){}
<a name="l00549"></a><a class="code" href="a00457.html#a8a48060f623c45e77d3a08afe55104d">00549</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"no"</span>;}
<a name="l00550"></a>00550     };
<a name="l00551"></a>00551     
<a name="l00567"></a><a class="code" href="a00516.html">00567</a>     <span class="keyword">class </span><a class="code" href="a00516.html">SimpleStatisticPolicy</a>
<a name="l00568"></a>00568     {
<a name="l00569"></a>00569     <span class="keyword">private</span>:
<a name="l00570"></a>00570         <span class="keywordtype">unsigned</span> allocated, created, hit, out, fetched;
<a name="l00571"></a>00571     <span class="keyword">protected</span>:
<a name="l00572"></a><a class="code" href="a00516.html#53dc1422a9f946aa9ee0739a11cf5044">00572</a>         <a class="code" href="a00516.html">SimpleStatisticPolicy</a>() : allocated(0), created(0), hit(0), out(0), fetched(0)
<a name="l00573"></a>00573         {
<a name="l00574"></a>00574         }
<a name="l00575"></a>00575         
<a name="l00576"></a><a class="code" href="a00516.html#1f021b071b79b5eba68e43e0a4537a9e">00576</a>         <span class="keywordtype">void</span> onDebug()
<a name="l00577"></a>00577         {
<a name="l00578"></a>00578           <span class="keyword">using namespace </span>std;
<a name="l00579"></a>00579             cout &lt;&lt; <span class="stringliteral">"############################"</span> &lt;&lt; endl;
<a name="l00580"></a>00580             cout &lt;&lt; <span class="stringliteral">"## About this cache "</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; endl;
<a name="l00581"></a>00581             cout &lt;&lt; <span class="stringliteral">"## + Created objects     : "</span> &lt;&lt; created &lt;&lt; endl;
<a name="l00582"></a>00582             cout &lt;&lt; <span class="stringliteral">"## + Fetched objects     : "</span> &lt;&lt; fetched &lt;&lt; endl;
<a name="l00583"></a>00583             cout &lt;&lt; <span class="stringliteral">"## + Destroyed objects   : "</span> &lt;&lt; created - allocated &lt;&lt; endl;
<a name="l00584"></a>00584             cout &lt;&lt; <span class="stringliteral">"## + Cache hit           : "</span> &lt;&lt; hit &lt;&lt; endl;
<a name="l00585"></a>00585             cout &lt;&lt; <span class="stringliteral">"## + Cache miss          : "</span> &lt;&lt; fetched - hit &lt;&lt; endl;
<a name="l00586"></a>00586             cout &lt;&lt; <span class="stringliteral">"## + Currently allocated : "</span> &lt;&lt; allocated &lt;&lt; endl;
<a name="l00587"></a>00587             cout &lt;&lt; <span class="stringliteral">"## + Currently out       : "</span> &lt;&lt; out &lt;&lt; endl;
<a name="l00588"></a>00588             cout &lt;&lt; <span class="stringliteral">"############################"</span> &lt;&lt; endl;
<a name="l00589"></a>00589             <span class="keywordflow">if</span>(fetched!=0){
<a name="l00590"></a>00590                 cout &lt;&lt; <span class="stringliteral">"## Overall efficiency "</span> &lt;&lt; 100*double(hit)/fetched &lt;&lt;<span class="stringliteral">"%"</span>&lt;&lt; endl;
<a name="l00591"></a>00591                 cout &lt;&lt; <span class="stringliteral">"############################"</span> &lt;&lt; endl;
<a name="l00592"></a>00592             }
<a name="l00593"></a>00593             cout &lt;&lt; endl;
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595         
<a name="l00596"></a><a class="code" href="a00516.html#b66f45af9159f727a0d45fe1e3b0ad6d">00596</a>         <span class="keywordtype">void</span> onFetch()
<a name="l00597"></a>00597         {
<a name="l00598"></a>00598             ++fetched;
<a name="l00599"></a>00599             ++out;
<a name="l00600"></a>00600             ++hit;
<a name="l00601"></a>00601         }
<a name="l00602"></a><a class="code" href="a00516.html#89144cf94d0764e80c9c3cfe17b3211b">00602</a>         <span class="keywordtype">void</span> onRelease()
<a name="l00603"></a>00603         {
<a name="l00604"></a>00604             --out;
<a name="l00605"></a>00605         }
<a name="l00606"></a><a class="code" href="a00516.html#fb90a2e7e0d10a482d725510eaefc374">00606</a>         <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>()
<a name="l00607"></a>00607         {
<a name="l00608"></a>00608             ++created;
<a name="l00609"></a>00609             ++allocated;
<a name="l00610"></a>00610             --hit;
<a name="l00611"></a>00611         }
<a name="l00612"></a><a class="code" href="a00516.html#f29de3495a92e6ae125a1560386a1328">00612</a>         <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>()
<a name="l00613"></a>00613         {
<a name="l00614"></a>00614             --allocated;
<a name="l00615"></a>00615         }
<a name="l00616"></a>00616 
<a name="l00617"></a><a class="code" href="a00516.html#aff6ca5b674d26e3e5e06ab2d25c62e1">00617</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="a00479.html#71e5b536754af404d77eb643cbb9742b">name</a>(){<span class="keywordflow">return</span> <span class="stringliteral">"simple"</span>;}
<a name="l00618"></a>00618     <span class="keyword">public</span>:
<a name="l00619"></a><a class="code" href="a00516.html#1ea0f0aa571233e43d9f22f576e63fd3">00619</a>         <span class="keywordtype">unsigned</span> getCreated(){<span class="keywordflow">return</span> created;}
<a name="l00620"></a><a class="code" href="a00516.html#c1d8f7952cea512cac935f3f0ce8d43d">00620</a>         <span class="keywordtype">unsigned</span> getFetched(){<span class="keywordflow">return</span> fetched;}
<a name="l00621"></a><a class="code" href="a00516.html#8708f093b7c911f49de902f7f49c01c4">00621</a>         <span class="keywordtype">unsigned</span> getHit(){<span class="keywordflow">return</span> hit;}
<a name="l00622"></a><a class="code" href="a00516.html#4804bfa6db149775f236c45b30e6d6d7">00622</a>         <span class="keywordtype">unsigned</span> getMissed(){<span class="keywordflow">return</span> fetched - hit;}
<a name="l00623"></a><a class="code" href="a00516.html#fe176bd54c304b39200881f11b331a4d">00623</a>         <span class="keywordtype">unsigned</span> getAllocated(){<span class="keywordflow">return</span> allocated;}
<a name="l00624"></a><a class="code" href="a00516.html#4e7cc331fccc09876750ad5438732a96">00624</a>         <span class="keywordtype">unsigned</span> getOut(){<span class="keywordflow">return</span> out;}
<a name="l00625"></a><a class="code" href="a00516.html#96f4dbe91505b67e473e305cedbd18f6">00625</a>         <span class="keywordtype">unsigned</span> getDestroyed(){<span class="keywordflow">return</span> created-allocated;}
<a name="l00626"></a>00626     }; 
<a name="l00627"></a>00627     
<a name="l00629"></a>00629     <span class="comment">// Cache Factory definition</span>
<a name="l00631"></a><a class="code" href="a00039.html">00631</a> <span class="comment"></span>    <span class="keyword">class </span><a class="code" href="a00039.html">CacheException</a> : <span class="keyword">public</span> std::exception
<a name="l00632"></a>00632     {
<a name="l00633"></a>00633     <span class="keyword">public</span>:
<a name="l00634"></a><a class="code" href="a00039.html#13d58ec00874124a145f1da312726204">00634</a>         <span class="keyword">const</span> <span class="keywordtype">char</span>* what() const throw() { <span class="keywordflow">return</span> <span class="stringliteral">"Internal Cache Error"</span>; }
<a name="l00635"></a>00635     };
<a name="l00636"></a>00636      
<a name="l00648"></a>00648       <span class="keyword">template</span>
<a name="l00649"></a>00649      &lt;
<a name="l00650"></a>00650         <span class="keyword">class </span>AbstractProduct,
<a name="l00651"></a>00651         <span class="keyword">typename</span> IdentifierType,
<a name="l00652"></a>00652         <span class="keyword">typename</span> CreatorParmTList = NullType,
<a name="l00653"></a>00653         <span class="keyword">template</span>&lt;<span class="keyword">class</span>&gt; <span class="keyword">class </span>EncapsulationPolicy = SimplePointer,
<a name="l00654"></a>00654         <span class="keyword">class </span>CreationPolicy = AlwaysCreate,
<a name="l00655"></a>00655         <span class="keyword">template</span> &lt;<span class="keyword">typename</span> , <span class="keyword">typename</span>&gt; <span class="keyword">class </span>EvictionPolicy = EvictRandom,
<a name="l00656"></a>00656         <span class="keyword">class </span>StatisticPolicy = NoStatisticPolicy,
<a name="l00657"></a>00657         <span class="keyword">template</span>&lt;<span class="keyword">typename</span>, <span class="keyword">class</span>&gt; <span class="keyword">class </span>FactoryErrorPolicy = DefaultFactoryError,
<a name="l00658"></a>00658         <span class="keyword">class </span>ObjVector = std::vector&lt;AbstractProduct*&gt;
<a name="l00659"></a>00659      &gt;
<a name="l00660"></a><a class="code" href="a00038.html">00660</a>       <span class="keyword">class </span><a class="code" href="a00038.html">CachedFactory</a> : 
<a name="l00661"></a>00661             <span class="keyword">protected</span> EncapsulationPolicy&lt;AbstractProduct&gt;,
<a name="l00662"></a>00662             <span class="keyword">public</span> CreationPolicy, <span class="keyword">public</span> StatisticPolicy, EvictionPolicy&lt; AbstractProduct * , unsigned &gt;
<a name="l00663"></a>00663       {
<a name="l00664"></a>00664      <span class="keyword">private</span>:
<a name="l00665"></a>00665         <span class="keyword">typedef</span> <a class="code" href="a00098.html">Factory&lt; AbstractProduct, IdentifierType, CreatorParmTList, FactoryErrorPolicy&gt;</a> <a class="code" href="a00098.html">Factory</a>;
<a name="l00666"></a>00666         <span class="keyword">typedef</span> FactoryImpl&lt; AbstractProduct, IdentifierType, CreatorParmTList &gt; Impl;
<a name="l00667"></a>00667         <span class="keyword">typedef</span> <a class="code" href="a00160.html">Functor&lt; AbstractProduct* , CreatorParmTList &gt;</a> <a class="code" href="a00160.html">ProductCreator</a>;
<a name="l00668"></a>00668         <span class="keyword">typedef</span> EncapsulationPolicy&lt;AbstractProduct&gt; NP;
<a name="l00669"></a>00669         <span class="keyword">typedef</span> CreationPolicy  CP;
<a name="l00670"></a>00670         <span class="keyword">typedef</span> StatisticPolicy SP;
<a name="l00671"></a>00671         <span class="keyword">typedef</span> EvictionPolicy&lt; AbstractProduct* , unsigned &gt; EP;
<a name="l00672"></a>00672                 
<a name="l00673"></a>00673         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm1 Parm1;
<a name="l00674"></a>00674         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm2 Parm2;
<a name="l00675"></a>00675         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm3 Parm3;
<a name="l00676"></a>00676         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm4 Parm4;
<a name="l00677"></a>00677         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm5 Parm5;
<a name="l00678"></a>00678         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm6 Parm6;
<a name="l00679"></a>00679         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm7 Parm7;
<a name="l00680"></a>00680         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm8 Parm8;
<a name="l00681"></a>00681         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm9 Parm9;
<a name="l00682"></a>00682         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm10 Parm10;
<a name="l00683"></a>00683         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm11 Parm11;
<a name="l00684"></a>00684         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm12 Parm12;
<a name="l00685"></a>00685         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm13 Parm13;
<a name="l00686"></a>00686         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm14 Parm14;
<a name="l00687"></a>00687         <span class="keyword">typedef</span> <span class="keyword">typename</span> Impl::Parm15 Parm15;
<a name="l00688"></a>00688         
<a name="l00689"></a>00689      <span class="keyword">public</span>:
<a name="l00690"></a><a class="code" href="a00038.html#2067d0fdbe613d4d581d6c38fa26f7f0">00690</a>         <span class="keyword">typedef</span> <span class="keyword">typename</span> NP::ProductReturn ProductReturn;
<a name="l00691"></a>00691      <span class="keyword">private</span>:
<a name="l00692"></a>00692         <span class="keyword">typedef</span> <a class="code" href="a00431.html">Key&lt; Impl, IdentifierType &gt;</a> <a class="code" href="a00431.html">Key</a>;
<a name="l00693"></a>00693         <span class="keyword">typedef</span> std::map&lt; Key, ObjVector &gt;  KeyToObjVectorMap;
<a name="l00694"></a>00694         <span class="keyword">typedef</span> std::map&lt; AbstractProduct*, Key &gt;  FetchedObjToKeyMap;
<a name="l00695"></a>00695         
<a name="l00696"></a>00696         <a class="code" href="a00098.html">Factory</a>             factory;
<a name="l00697"></a>00697         KeyToObjVectorMap   fromKeyToObjVector;
<a name="l00698"></a>00698         FetchedObjToKeyMap  providedObjects;
<a name="l00699"></a>00699         <span class="keywordtype">unsigned</span>            outObjects;
<a name="l00700"></a>00700 
<a name="l00701"></a>00701         ObjVector&amp; getContainerFromKey(<a class="code" href="a00431.html">Key</a> key){
<a name="l00702"></a>00702             <span class="keywordflow">return</span> fromKeyToObjVector[key];
<a name="l00703"></a>00703         }
<a name="l00704"></a>00704 
<a name="l00705"></a>00705         AbstractProduct* <span class="keyword">const</span> getPointerToObjectInContainer(ObjVector &amp;entry)
<a name="l00706"></a>00706         {
<a name="l00707"></a>00707             <span class="keywordflow">if</span>(entry.empty()) <span class="comment">// No object available</span>
<a name="l00708"></a>00708             {   <span class="comment">// the object will be created in the calling function.</span>
<a name="l00709"></a>00709                 <span class="comment">// It has to be created in the calling function because of</span>
<a name="l00710"></a>00710                 <span class="comment">// the variable number of parameters for CreateObject(...) method</span>
<a name="l00711"></a>00711                 <span class="keywordflow">return</span> NULL;
<a name="l00712"></a>00712             }
<a name="l00713"></a>00713             <span class="keywordflow">else</span>
<a name="l00714"></a>00714             {   <span class="comment">// returning the found object</span>
<a name="l00715"></a>00715                     AbstractProduct* pObject(entry.back());
<a name="l00716"></a>00716                     assert(pObject!=NULL);
<a name="l00717"></a>00717                     entry.pop_back();
<a name="l00718"></a>00718                 <span class="keywordflow">return</span> pObject;
<a name="l00719"></a>00719             }
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721         
<a name="l00722"></a>00722         <span class="keywordtype">bool</span> shouldCreateObject(AbstractProduct * <span class="keyword">const</span> pProduct){
<a name="l00723"></a>00723             <span class="keywordflow">if</span>(pProduct!=NULL) <span class="comment">// object already exists</span>
<a name="l00724"></a>00724                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00725"></a>00725             <span class="keywordflow">if</span>(CP::canCreate()==<span class="keyword">false</span>) <span class="comment">// Are we allowed to Create ?</span>
<a name="l00726"></a>00726                 EP::evict(); <span class="comment">// calling Eviction Policy to clean up</span>
<a name="l00727"></a>00727             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729         
<a name="l00730"></a>00730         <span class="keywordtype">void</span> ReleaseObjectFromContainer(ObjVector &amp;entry, AbstractProduct * <span class="keyword">const</span> object)
<a name="l00731"></a>00731         {
<a name="l00732"></a>00732             entry.push_back(object);
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734         
<a name="l00735"></a>00735         <span class="keywordtype">void</span> onFetch(AbstractProduct * <span class="keyword">const</span> pProduct)
<a name="l00736"></a>00736         {
<a name="l00737"></a>00737             SP::onFetch();
<a name="l00738"></a>00738             EP::onFetch(pProduct);
<a name="l00739"></a>00739             ++outObjects;
<a name="l00740"></a>00740         }
<a name="l00741"></a>00741         
<a name="l00742"></a>00742         <span class="keywordtype">void</span> onRelease(AbstractProduct * <span class="keyword">const</span> pProduct)
<a name="l00743"></a>00743         {
<a name="l00744"></a>00744             SP::onRelease();
<a name="l00745"></a>00745             EP::onRelease(pProduct);
<a name="l00746"></a>00746             --outObjects;
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748         
<a name="l00749"></a>00749         <span class="keywordtype">void</span> <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(AbstractProduct * <span class="keyword">const</span> pProduct)
<a name="l00750"></a>00750         {
<a name="l00751"></a>00751             CP::onCreate();
<a name="l00752"></a>00752             SP::onCreate();
<a name="l00753"></a>00753             EP::onCreate(pProduct);
<a name="l00754"></a>00754         }
<a name="l00755"></a>00755         
<a name="l00756"></a>00756         <span class="keywordtype">void</span> <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(AbstractProduct * <span class="keyword">const</span> pProduct)
<a name="l00757"></a>00757         {
<a name="l00758"></a>00758             CP::onDestroy();
<a name="l00759"></a>00759             SP::onDestroy();
<a name="l00760"></a>00760             EP::onDestroy(pProduct);
<a name="l00761"></a>00761         }
<a name="l00762"></a>00762           
<a name="l00763"></a>00763           <span class="comment">// delete the object</span>
<a name="l00764"></a>00764           <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span>deleteObject : <span class="keyword">public</span> std::unary_function&lt;T, void&gt;
<a name="l00765"></a>00765           {
<a name="l00766"></a>00766                <span class="keywordtype">void</span> operator()(T x){ <span class="keyword">delete</span> x; }
<a name="l00767"></a>00767           };
<a name="l00768"></a>00768 
<a name="l00769"></a>00769           <span class="comment">// delete the objects in the vector</span>
<a name="l00770"></a>00770           <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span>deleteVectorObjects : <span class="keyword">public</span> std::unary_function&lt;T, void&gt;
<a name="l00771"></a>00771           {
<a name="l00772"></a>00772                <span class="keywordtype">void</span> operator()(T x){
<a name="l00773"></a>00773                     ObjVector &amp;vec(x.second);
<a name="l00774"></a>00774                     std::for_each(vec.begin(), vec.end(), deleteObject&lt; typename ObjVector::value_type&gt;());
<a name="l00775"></a>00775                }
<a name="l00776"></a>00776           };
<a name="l00777"></a>00777 
<a name="l00778"></a>00778           <span class="comment">// delete the keys of the map</span>
<a name="l00779"></a>00779           <span class="keyword">template</span>&lt;<span class="keyword">class</span> T&gt; <span class="keyword">struct </span>deleteMapKeys : <span class="keyword">public</span> std::unary_function&lt;T, void&gt;
<a name="l00780"></a>00780           {
<a name="l00781"></a>00781                <span class="keywordtype">void</span> operator()(T x){ <span class="keyword">delete</span> x.first; }
<a name="l00782"></a>00782           };            
<a name="l00783"></a>00783 
<a name="l00784"></a>00784      <span class="keyword">protected</span>:
<a name="l00785"></a><a class="code" href="a00038.html#602f1ca3f2f2015f26386da61254ab6f">00785</a>         <span class="keyword">virtual</span> <span class="keywordtype">void</span> remove(AbstractProduct * <span class="keyword">const</span> pProduct)
<a name="l00786"></a>00786         {
<a name="l00787"></a>00787             <span class="keyword">typename</span> FetchedObjToKeyMap::iterator fetchedItr = providedObjects.find(pProduct);
<a name="l00788"></a>00788             <span class="keywordflow">if</span>(fetchedItr!=providedObjects.end()) <span class="comment">// object is unreleased.</span>
<a name="l00789"></a>00789                 <span class="keywordflow">throw</span> <a class="code" href="a00039.html">CacheException</a>();
<a name="l00790"></a>00790             <span class="keywordtype">bool</span> productRemoved = <span class="keyword">false</span>;
<a name="l00791"></a>00791             <span class="keyword">typename</span> KeyToObjVectorMap::iterator objVectorItr;
<a name="l00792"></a>00792             <span class="keyword">typename</span> ObjVector::iterator objItr;
<a name="l00793"></a>00793             <span class="keywordflow">for</span>(objVectorItr=fromKeyToObjVector.begin();objVectorItr!=fromKeyToObjVector.end();++objVectorItr)
<a name="l00794"></a>00794             {
<a name="l00795"></a>00795                 ObjVector &amp;v((*objVectorItr).second);
<a name="l00796"></a>00796                 objItr = remove_if(v.begin(), v.end(), std::bind2nd(std::equal_to&lt;AbstractProduct*&gt;(), pProduct));
<a name="l00797"></a>00797                 <span class="keywordflow">if</span>(objItr != v.end()) <span class="comment">// we found the vector containing pProduct and removed it</span>
<a name="l00798"></a>00798                 {
<a name="l00799"></a>00799                     <a class="code" href="a00479.html#2e6ea4404c927e369ee86d79a07992bc">onDestroy</a>(pProduct); <span class="comment">// warning policies we are about to destroy an object</span>
<a name="l00800"></a>00800                     v.erase(objItr, v.end()); <span class="comment">// real removing</span>
<a name="l00801"></a>00801                     productRemoved = <span class="keyword">true</span>;
<a name="l00802"></a>00802                     <span class="keywordflow">break</span>;
<a name="l00803"></a>00803                 }
<a name="l00804"></a>00804             }
<a name="l00805"></a>00805             <span class="keywordflow">if</span>(productRemoved==<span class="keyword">false</span>)
<a name="l00806"></a>00806                 <span class="keywordflow">throw</span> <a class="code" href="a00039.html">CacheException</a>(); <span class="comment">// the product is not in the cache ?!</span>
<a name="l00807"></a>00807             <span class="keyword">delete</span> pProduct; <span class="comment">// deleting it</span>
<a name="l00808"></a>00808         }
<a name="l00809"></a>00809 
<a name="l00810"></a>00810      <span class="keyword">public</span>:
<a name="l00811"></a><a class="code" href="a00038.html#a647df42bd9d4a4277eb509913dfddd0">00811</a>         <a class="code" href="a00038.html">CachedFactory</a>() : factory(), fromKeyToObjVector(), providedObjects(), outObjects(0)
<a name="l00812"></a>00812         {
<a name="l00813"></a>00813         }
<a name="l00814"></a>00814 
<a name="l00815"></a><a class="code" href="a00038.html#69d01b4fc38ab06a20a7f28282211316">00815</a>         ~<a class="code" href="a00038.html">CachedFactory</a>()
<a name="l00816"></a>00816         {
<a name="l00817"></a>00817           <span class="keyword">using namespace </span>std;
<a name="l00818"></a>00818             <span class="comment">// debug information</span>
<a name="l00819"></a>00819             SP::onDebug();
<a name="l00820"></a>00820             <span class="comment">// cleaning the Cache</span>
<a name="l00821"></a>00821             for_each(fromKeyToObjVector.begin(), fromKeyToObjVector.end(),
<a name="l00822"></a>00822                deleteVectorObjects&lt; typename KeyToObjVectorMap::value_type &gt;()
<a name="l00823"></a>00823             );
<a name="l00824"></a>00824             <span class="keywordflow">if</span>(!providedObjects.empty())
<a name="l00825"></a>00825             {
<a name="l00826"></a>00826                     <span class="comment">// The factory is responsible for the creation and destruction of objects.</span>
<a name="l00827"></a>00827                     <span class="comment">// If objects are out during the destruction of the Factory : deleting anyway.</span>
<a name="l00828"></a>00828                     <span class="comment">// This might not be a good idea. But throwing an exception in a destructor is</span>
<a name="l00829"></a>00829                     <span class="comment">// considered as a bad pratice and asserting might be too much.</span>
<a name="l00830"></a>00830                     <span class="comment">// What to do ? Leaking memory or corrupting in use pointers ? hmm...</span>
<a name="l00831"></a>00831                 D( cout &lt;&lt; <span class="stringliteral">"====&gt;&gt;  Cache destructor : deleting "</span>&lt;&lt; providedObjects.size()&lt;&lt;<span class="stringliteral">" in use objects  &lt;&lt;===="</span> &lt;&lt; endl &lt;&lt; endl; )
<a name="l00832"></a>00832                 for_each(providedObjects.begin(), providedObjects.end(),
<a name="l00833"></a>00833                      deleteMapKeys&lt; typename FetchedObjToKeyMap::value_type &gt;()
<a name="l00834"></a>00834                 );
<a name="l00835"></a>00835             }
<a name="l00836"></a>00836         }
<a name="l00837"></a>00837         
<a name="l00839"></a>00839         <span class="comment">// Acts as the proxy pattern and //</span>
<a name="l00840"></a>00840         <span class="comment">// forwards factory methods      //</span>
<a name="l00842"></a>00842 <span class="comment"></span>        
<a name="l00843"></a><a class="code" href="a00038.html#036a0769dd53bfa95ff2f8068a696ee8">00843</a>         <span class="keywordtype">bool</span> Register(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>, <a class="code" href="a00160.html">ProductCreator</a> creator)
<a name="l00844"></a>00844         {
<a name="l00845"></a>00845             <span class="keywordflow">return</span> factory.Register(<span class="keywordtype">id</span>, creator);
<a name="l00846"></a>00846         }
<a name="l00847"></a>00847         
<a name="l00848"></a>00848         <span class="keyword">template</span> &lt;<span class="keyword">class</span> PtrObj, <span class="keyword">typename</span> CreaFn&gt;
<a name="l00849"></a><a class="code" href="a00038.html#c7ffa4e422390161b06c3e76c55a072b">00849</a>         <span class="keywordtype">bool</span> Register(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> PtrObj&amp; p, CreaFn fn)
<a name="l00850"></a>00850         {
<a name="l00851"></a>00851             <span class="keywordflow">return</span> factory.Register(<span class="keywordtype">id</span>, p, fn);
<a name="l00852"></a>00852         }
<a name="l00853"></a>00853         
<a name="l00854"></a><a class="code" href="a00038.html#2f2313c2adb3e13784ab875c0017d8c4">00854</a>         <span class="keywordtype">bool</span> Unregister(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>)
<a name="l00855"></a>00855         {
<a name="l00856"></a>00856             <span class="keywordflow">return</span> factory.Unregister(<span class="keywordtype">id</span>);
<a name="l00857"></a>00857         }
<a name="l00858"></a>00858 
<a name="l00860"></a><a class="code" href="a00038.html#be003d4613debd4079cf26f5c13aabc6">00860</a>         std::vector&lt;IdentifierType&gt;&amp; RegisteredIds()
<a name="l00861"></a>00861         {
<a name="l00862"></a>00862             <span class="keywordflow">return</span> factory.RegisteredIds();
<a name="l00863"></a>00863         }
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="a00038.html#c9f1876442472a990aaa151f4c836299">00865</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>)
<a name="l00866"></a>00866         {
<a name="l00867"></a>00867             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>);
<a name="l00868"></a>00868             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00869"></a>00869             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00870"></a>00870             {
<a name="l00871"></a>00871                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>);
<a name="l00872"></a>00872                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00873"></a>00873             }
<a name="l00874"></a>00874             onFetch(pProduct);
<a name="l00875"></a>00875             providedObjects[pProduct] = key;
<a name="l00876"></a>00876             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00877"></a>00877         }
<a name="l00878"></a>00878         
<a name="l00879"></a><a class="code" href="a00038.html#bfeed016c71081340153b6d6a0f85986">00879</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00880"></a>00880                         Parm1 p1)
<a name="l00881"></a>00881         {
<a name="l00882"></a>00882             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1);
<a name="l00883"></a>00883             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00884"></a>00884             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00885"></a>00885             {
<a name="l00886"></a>00886                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>);
<a name="l00887"></a>00887                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00888"></a>00888             }
<a name="l00889"></a>00889             onFetch(pProduct);
<a name="l00890"></a>00890             providedObjects[pProduct] = key;
<a name="l00891"></a>00891             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00892"></a>00892         }
<a name="l00893"></a>00893 
<a name="l00894"></a><a class="code" href="a00038.html#40d700079169e23e448e27340838ae24">00894</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00895"></a>00895                         Parm1 p1, Parm2 p2)
<a name="l00896"></a>00896         {
<a name="l00897"></a>00897             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2);
<a name="l00898"></a>00898             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00899"></a>00899             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00900"></a>00900             {
<a name="l00901"></a>00901                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>);
<a name="l00902"></a>00902                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00903"></a>00903             }
<a name="l00904"></a>00904             onFetch(pProduct);
<a name="l00905"></a>00905             providedObjects[pProduct] = key;
<a name="l00906"></a>00906             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00907"></a>00907         }
<a name="l00908"></a>00908 
<a name="l00909"></a><a class="code" href="a00038.html#6fb625b45e7672fcd0715f782981c600">00909</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00910"></a>00910                         Parm1 p1, Parm2 p2, Parm3 p3)
<a name="l00911"></a>00911         {
<a name="l00912"></a>00912             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3);
<a name="l00913"></a>00913             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00914"></a>00914             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00915"></a>00915             {
<a name="l00916"></a>00916                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>);
<a name="l00917"></a>00917                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00918"></a>00918             }
<a name="l00919"></a>00919             onFetch(pProduct);
<a name="l00920"></a>00920             providedObjects[pProduct] = key;
<a name="l00921"></a>00921             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00922"></a>00922         }
<a name="l00923"></a>00923 
<a name="l00924"></a><a class="code" href="a00038.html#af6df3387bdcd35da141d43afd3062a8">00924</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00925"></a>00925                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4)
<a name="l00926"></a>00926         {
<a name="l00927"></a>00927             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4);
<a name="l00928"></a>00928             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00929"></a>00929             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00930"></a>00930             {
<a name="l00931"></a>00931                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l00932"></a>00932                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>);
<a name="l00933"></a>00933                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00934"></a>00934             }
<a name="l00935"></a>00935             onFetch(pProduct);
<a name="l00936"></a>00936             providedObjects[pProduct] = key;
<a name="l00937"></a>00937             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00938"></a>00938         }
<a name="l00939"></a>00939 
<a name="l00940"></a><a class="code" href="a00038.html#54a3cd2b88a0f033877ad825d450964d">00940</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00941"></a>00941                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5)
<a name="l00942"></a>00942         {
<a name="l00943"></a>00943             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5);
<a name="l00944"></a>00944             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00945"></a>00945             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00946"></a>00946             {
<a name="l00947"></a>00947                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l00948"></a>00948                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>);
<a name="l00949"></a>00949                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00950"></a>00950             }
<a name="l00951"></a>00951             onFetch(pProduct);
<a name="l00952"></a>00952             providedObjects[pProduct] = key;
<a name="l00953"></a>00953             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00954"></a>00954         }
<a name="l00955"></a>00955 
<a name="l00956"></a><a class="code" href="a00038.html#f497ffeaa7da0a5cadafa16a8f7e885c">00956</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00957"></a>00957                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5,
<a name="l00958"></a>00958                         Parm6 p6)
<a name="l00959"></a>00959         {
<a name="l00960"></a>00960             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6);
<a name="l00961"></a>00961             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00962"></a>00962             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00963"></a>00963             {
<a name="l00964"></a>00964                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l00965"></a>00965                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>);
<a name="l00966"></a>00966                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00967"></a>00967             }
<a name="l00968"></a>00968             onFetch(pProduct);
<a name="l00969"></a>00969             providedObjects[pProduct] = key;
<a name="l00970"></a>00970             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00971"></a>00971         }
<a name="l00972"></a>00972 
<a name="l00973"></a><a class="code" href="a00038.html#93f6b4b9dce6b893f11d6a0556b4b3d5">00973</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00974"></a>00974                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5,
<a name="l00975"></a>00975                         Parm6 p6, Parm7 p7 )
<a name="l00976"></a>00976         {
<a name="l00977"></a>00977             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7);
<a name="l00978"></a>00978             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00979"></a>00979             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00980"></a>00980             {
<a name="l00981"></a>00981                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l00982"></a>00982                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>);
<a name="l00983"></a>00983                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l00984"></a>00984             }
<a name="l00985"></a>00985             onFetch(pProduct);
<a name="l00986"></a>00986             providedObjects[pProduct] = key;
<a name="l00987"></a>00987             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l00988"></a>00988         }
<a name="l00989"></a>00989 
<a name="l00990"></a><a class="code" href="a00038.html#26df27099d401ffd3af592f92747e969">00990</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l00991"></a>00991                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5,
<a name="l00992"></a>00992                         Parm6 p6, Parm7 p7, Parm8 p8)
<a name="l00993"></a>00993         {
<a name="l00994"></a>00994             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8);
<a name="l00995"></a>00995             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l00996"></a>00996             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l00997"></a>00997             {
<a name="l00998"></a>00998                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l00999"></a>00999                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>);
<a name="l01000"></a>01000                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01001"></a>01001             }
<a name="l01002"></a>01002             onFetch(pProduct);
<a name="l01003"></a>01003             providedObjects[pProduct] = key;
<a name="l01004"></a>01004             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01005"></a>01005         }
<a name="l01006"></a>01006 
<a name="l01007"></a><a class="code" href="a00038.html#f6347d97a47a204ed2bea8a617a19eaf">01007</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01008"></a>01008                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5,
<a name="l01009"></a>01009                         Parm6 p6, Parm7 p7, Parm8 p8, Parm9 p9)
<a name="l01010"></a>01010         {
<a name="l01011"></a>01011             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9);
<a name="l01012"></a>01012             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01013"></a>01013             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01014"></a>01014             {
<a name="l01015"></a>01015                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01016"></a>01016                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>);
<a name="l01017"></a>01017                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01018"></a>01018             }
<a name="l01019"></a>01019             onFetch(pProduct);
<a name="l01020"></a>01020             providedObjects[pProduct] = key;
<a name="l01021"></a>01021             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023         
<a name="l01024"></a><a class="code" href="a00038.html#274f4e69369cabfe3ed7c098306718f9">01024</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01025"></a>01025                         Parm1 p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5 p5,
<a name="l01026"></a>01026                         Parm6 p6, Parm7 p7, Parm8 p8, Parm9 p9,Parm10 p10)
<a name="l01027"></a>01027         {
<a name="l01028"></a>01028             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10);
<a name="l01029"></a>01029             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01030"></a>01030             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01031"></a>01031             {
<a name="l01032"></a>01032                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01033"></a>01033                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>);
<a name="l01034"></a>01034                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01035"></a>01035             }
<a name="l01036"></a>01036             onFetch(pProduct);
<a name="l01037"></a>01037             providedObjects[pProduct] = key;
<a name="l01038"></a>01038             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040 
<a name="l01041"></a><a class="code" href="a00038.html#f37ee6de86a4a1711dae05cdb879deb6">01041</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01042"></a>01042                         Parm1  p1, Parm2 p2, Parm3 p3, Parm4 p4, Parm5  p5,
<a name="l01043"></a>01043                         Parm6  p6, Parm7 p7, Parm8 p8, Parm9 p9, Parm10 p10,
<a name="l01044"></a>01044                         Parm11 p11)
<a name="l01045"></a>01045         {
<a name="l01046"></a>01046             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11);
<a name="l01047"></a>01047             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01048"></a>01048             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01049"></a>01049             {
<a name="l01050"></a>01050                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01051"></a>01051                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>,key.<a class="code" href="a00431.html#d291cc5a149ba664ef6553aca1674187">p11</a>);
<a name="l01052"></a>01052                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01053"></a>01053             }
<a name="l01054"></a>01054             onFetch(pProduct);
<a name="l01055"></a>01055             providedObjects[pProduct] = key;
<a name="l01056"></a>01056             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01057"></a>01057         }
<a name="l01058"></a>01058 
<a name="l01059"></a><a class="code" href="a00038.html#19dfe1c252f1f7e08da2fb54e8fd7b64">01059</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01060"></a>01060                         Parm1  p1,  Parm2  p2, Parm3 p3, Parm4 p4, Parm5  p5,
<a name="l01061"></a>01061                         Parm6  p6,  Parm7  p7, Parm8 p8, Parm9 p9, Parm10 p10,
<a name="l01062"></a>01062                         Parm11 p11, Parm12 p12)
<a name="l01063"></a>01063         {
<a name="l01064"></a>01064             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12);
<a name="l01065"></a>01065             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01066"></a>01066             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01067"></a>01067             {
<a name="l01068"></a>01068                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01069"></a>01069                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>,key.<a class="code" href="a00431.html#d291cc5a149ba664ef6553aca1674187">p11</a>,key.<a class="code" href="a00431.html#22d3cf586cf0df63f53b5bc78ece2b07">p12</a>);
<a name="l01070"></a>01070                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01071"></a>01071             }
<a name="l01072"></a>01072             onFetch(pProduct);
<a name="l01073"></a>01073             providedObjects[pProduct] = key;
<a name="l01074"></a>01074             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01075"></a>01075         }
<a name="l01076"></a>01076 
<a name="l01077"></a><a class="code" href="a00038.html#e3067a103cac7fe858ded09c4d72b01d">01077</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01078"></a>01078                         Parm1  p1,  Parm2  p2,  Parm3  p3, Parm4 p4, Parm5  p5,
<a name="l01079"></a>01079                         Parm6  p6,  Parm7  p7,  Parm8  p8, Parm9 p9, Parm10 p10,
<a name="l01080"></a>01080                         Parm11 p11, Parm12 p12, Parm13 p13)
<a name="l01081"></a>01081         {
<a name="l01082"></a>01082             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13);
<a name="l01083"></a>01083             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01084"></a>01084             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01085"></a>01085             {
<a name="l01086"></a>01086                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01087"></a>01087                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>,key.<a class="code" href="a00431.html#d291cc5a149ba664ef6553aca1674187">p11</a>,key.<a class="code" href="a00431.html#22d3cf586cf0df63f53b5bc78ece2b07">p12</a>
<a name="l01088"></a>01088                 ,key.<a class="code" href="a00431.html#c04cf1ca35e0524c351c8c41471cf990">p13</a>);
<a name="l01089"></a>01089                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01090"></a>01090             }
<a name="l01091"></a>01091             onFetch(pProduct);
<a name="l01092"></a>01092             providedObjects[pProduct] = key;
<a name="l01093"></a>01093             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01094"></a>01094         }
<a name="l01095"></a>01095 
<a name="l01096"></a><a class="code" href="a00038.html#96f048f0680850edc311538b8ec4b768">01096</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01097"></a>01097                         Parm1  p1,  Parm2  p2,  Parm3  p3,  Parm4  p4, Parm5  p5,
<a name="l01098"></a>01098                         Parm6  p6,  Parm7  p7,  Parm8  p8,  Parm9  p9, Parm10 p10,
<a name="l01099"></a>01099                         Parm11 p11, Parm12 p12, Parm13 p13, Parm14 p14)
<a name="l01100"></a>01100         {
<a name="l01101"></a>01101             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14);
<a name="l01102"></a>01102             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01103"></a>01103             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01104"></a>01104             {
<a name="l01105"></a>01105                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01106"></a>01106                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>,key.<a class="code" href="a00431.html#d291cc5a149ba664ef6553aca1674187">p11</a>,key.<a class="code" href="a00431.html#22d3cf586cf0df63f53b5bc78ece2b07">p12</a>
<a name="l01107"></a>01107                 ,key.<a class="code" href="a00431.html#c04cf1ca35e0524c351c8c41471cf990">p13</a>,key.<a class="code" href="a00431.html#a2f05832ecdc610605bf8e7122c4d0ea">p14</a>);
<a name="l01108"></a>01108                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01109"></a>01109             }
<a name="l01110"></a>01110             onFetch(pProduct);
<a name="l01111"></a>01111             providedObjects[pProduct] = key;
<a name="l01112"></a>01112             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114 
<a name="l01115"></a><a class="code" href="a00038.html#e9a8daab85331da17667040452cba7c1">01115</a>         ProductReturn CreateObject(<span class="keyword">const</span> IdentifierType&amp; <span class="keywordtype">id</span>,
<a name="l01116"></a>01116                         Parm1  p1,  Parm2  p2,  Parm3  p3,  Parm4  p4,  Parm5  p5,
<a name="l01117"></a>01117                         Parm6  p6,  Parm7  p7,  Parm8  p8,  Parm9  p9,  Parm10 p10,
<a name="l01118"></a>01118                         Parm11 p11, Parm12 p12, Parm13 p13, Parm14 p14, Parm15 p15)
<a name="l01119"></a>01119         {
<a name="l01120"></a>01120             <a class="code" href="a00431.html">Key</a> key(<span class="keywordtype">id</span>,p1,p2,p3,p4,p5,p6,p7,p8,p9,p10,p11,p12,p13,p14,p15);
<a name="l01121"></a>01121             AbstractProduct *pProduct(getPointerToObjectInContainer(getContainerFromKey(key)));
<a name="l01122"></a>01122             <span class="keywordflow">if</span>(shouldCreateObject(pProduct))
<a name="l01123"></a>01123             {
<a name="l01124"></a>01124                 pProduct = factory.CreateObject(key.<a class="code" href="a00431.html#1b3fe80bc4a6b800ae0329aec4e210ca">id</a>,key.<a class="code" href="a00431.html#cd749a7adb127800b3e5450993d93c08">p1</a>,key.<a class="code" href="a00431.html#259829facb9f7a2c1e70f50b07a2f43a">p2</a>,key.<a class="code" href="a00431.html#0c7f98ae0882ff7f82878cec477ece39">p3</a>
<a name="l01125"></a>01125                 ,key.<a class="code" href="a00431.html#6258cd525b853b8b4a12e87192a7038e">p4</a>,key.<a class="code" href="a00431.html#8284f162e368c2e9e7590ef1c9b0028c">p5</a>,key.<a class="code" href="a00431.html#04230deee939a53a6d72bec4eaec9c7e">p6</a>,key.<a class="code" href="a00431.html#edecbf64a4844480e7f0179fb4c48771">p7</a>,key.<a class="code" href="a00431.html#3ccb6902d69c6aa13f9510407464906a">p8</a>,key.<a class="code" href="a00431.html#933ce98969882c3ec862453387a6c633">p9</a>,key.<a class="code" href="a00431.html#b864782b70c0beb09ba2c9dc4da9b456">p10</a>,key.<a class="code" href="a00431.html#d291cc5a149ba664ef6553aca1674187">p11</a>,key.<a class="code" href="a00431.html#22d3cf586cf0df63f53b5bc78ece2b07">p12</a>
<a name="l01126"></a>01126                 ,key.<a class="code" href="a00431.html#c04cf1ca35e0524c351c8c41471cf990">p13</a>,key.<a class="code" href="a00431.html#a2f05832ecdc610605bf8e7122c4d0ea">p14</a>,key.<a class="code" href="a00431.html#a37b4905300f8da09be72cc69c66fb90">p15</a>);
<a name="l01127"></a>01127                 <a class="code" href="a00479.html#d1946e93bf52f52a55d0b5303c3c3d35">onCreate</a>(pProduct);
<a name="l01128"></a>01128             }
<a name="l01129"></a>01129             onFetch(pProduct);
<a name="l01130"></a>01130             providedObjects[pProduct] = key;
<a name="l01131"></a>01131             <span class="keywordflow">return</span> NP::encapsulate(pProduct);
<a name="l01132"></a>01132         }
<a name="l01133"></a>01133 
<a name="l01135"></a>01135 
<a name="l01140"></a><a class="code" href="a00038.html#c307db6556acef8179a260db4d573440">01140</a>         <span class="keywordtype">void</span> ReleaseObject(ProductReturn &amp;object)
<a name="l01141"></a>01141         {
<a name="l01142"></a>01142             AbstractProduct* pProduct(NP::release(object));
<a name="l01143"></a>01143             <span class="keyword">typename</span> FetchedObjToKeyMap::iterator itr = providedObjects.find(pProduct);
<a name="l01144"></a>01144             <span class="keywordflow">if</span>(itr == providedObjects.end())
<a name="l01145"></a>01145                 <span class="keywordflow">throw</span> <a class="code" href="a00039.html">CacheException</a>();
<a name="l01146"></a>01146             onRelease(pProduct);
<a name="l01147"></a>01147             ReleaseObjectFromContainer(getContainerFromKey((*itr).second), pProduct);
<a name="l01148"></a>01148             providedObjects.erase(itr);
<a name="l01149"></a>01149         }
<a name="l01150"></a>01150         
<a name="l01152"></a><a class="code" href="a00038.html#26534687a259fa84dcbb21c388a72134">01152</a>         <span class="keywordtype">void</span> displayCacheType()
<a name="l01153"></a>01153         {
<a name="l01154"></a>01154           <span class="keyword">using namespace </span>std;
<a name="l01155"></a>01155             cout &lt;&lt; <span class="stringliteral">"############################"</span> &lt;&lt; endl;
<a name="l01156"></a>01156             cout &lt;&lt; <span class="stringliteral">"## Cache configuration"</span> &lt;&lt; endl;
<a name="l01157"></a>01157             cout &lt;&lt; <span class="stringliteral">"## + Encapsulation "</span> &lt;&lt; NP::name() &lt;&lt; endl;
<a name="l01158"></a>01158             cout &lt;&lt; <span class="stringliteral">"## + Creating      "</span> &lt;&lt; CP::name() &lt;&lt; endl;
<a name="l01159"></a>01159             cout &lt;&lt; <span class="stringliteral">"## + Eviction      "</span> &lt;&lt; EP::name() &lt;&lt; endl;
<a name="l01160"></a>01160             cout &lt;&lt; <span class="stringliteral">"## + Statistics    "</span> &lt;&lt; SP::name() &lt;&lt; endl;
<a name="l01161"></a>01161             cout &lt;&lt; <span class="stringliteral">"############################"</span> &lt;&lt; endl;
<a name="l01162"></a>01162         }
<a name="l01163"></a>01163      };
<a name="l01164"></a>01164 } <span class="comment">// namespace Loki</span>
<a name="l01165"></a>01165 
<a name="l01166"></a>01166 <span class="preprocessor">#endif // end file guardian</span>
<a name="l01167"></a>01167 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Sun Feb 25 16:52:21 2007 for Loki by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.1-p1 </small></address>
</body>
</html>
